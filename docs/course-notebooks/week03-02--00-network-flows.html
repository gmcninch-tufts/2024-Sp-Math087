<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Math87-Tufts University - week03-02--00-network-flows</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
	</script>	
        <link rel="stylesheet" href="../css/default.css" />
	<link rel="stylesheet" href="../css/haddock.css" />
	
	<link href="https://fonts.googleapis.com/css?family=Lato:400,700" type="text/css" rel="stylesheet" media="screen" />
	<link href="https://fonts.googleapis.com/css?family=Arimo:400,700" type="text/css" rel="stylesheet" media="screen" />
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" rel="stylesheet" media="screen" />
	<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" type="text/css" rel="stylesheet" media="screen" />
	<link href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" type="text/css" rel="stylesheet" media="screen" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous" />			
    </head>
    <body>
        <header>
          <div class="logo">
            <a href="../">
	      Math87 - Spring 2024 - Tufts Univ</a>
          </div>
          <nav>
            <a href="../about.html">About</a>
	    <a href="../course-pages/Math087--course-info.html">Info</a>	    
            <a href="../archive.html">Archive</a>
          </nav>
        </header>

        <main role="main">
            <h1>week03-02--00-network-flows</h1>
            <div id="ee884cf9-25ed-4e51-904b-1f650fd539a6" class="cell markdown">

</div>
<div id="c5d76add-f8a6-4c54-b7d5-d3b74bd43bb4" class="cell markdown">
<h1 id="george-mcninch-math-87---spring-2024"><a href="http://gmcninch.math.tufts.edu">George McNinch</a> Math 87 - Spring 2024</h1>
<h1 id="week-3">Week 3</h1>
<h1 id="network-flows-and-linear-programming">§ Network flows and linear programming</h1>
</div>
<div id="26ed1832-dae4-4786-8528-f74936900424" class="cell markdown">
<h1 id="overview">Overview</h1>
<p>So far we have looked at a few examples of linear programs. The key step
in modeling these problems is to write down the linear program itself.</p>
<p>As we saw, for simple linear programs – such as the carpenter example –
we can figure it out geometrically. In that case, there were only a few
variables and a few obvious constraints, and it was easy to find and
check all the “vertices”.</p>
</div>
<div id="9366d6ab-5fa4-4f41-85de-370254ac5004" class="cell markdown">
<h1 id="network-flows">Network flows</h1>
<p>We are going to consider some more complex situations for which we will
use a <em>network flow</em> to help produce the corresponding *linear program.</p>
<p>Let’s recall that a <em>directed graph</em> is a pair <span class="math inline">\(G = (V,E)\)</span> where the
elements of the set <span class="math inline">\(V\)</span> are the <em>vertices</em> of the graph, and where
<span class="math inline">\(E ⊂ V × V\)</span> are the <em>edges</em> of <span class="math inline">\(G\)</span>. Thus, an element <span class="math inline">\(e = (a,b) ∈ E\)</span>
represents a directed edge from vertex <span class="math inline">\(a\)</span> to vertex <span class="math inline">\(b\)</span>.</p>
<p>We can produce diagrams for directed graphs using the program
<a href="https://graphviz.org/"><code>graphviz</code></a> (and a corresponding python library
<a href="https://github.com/xflr6/graphviz"><code>python-graphviz</code></a>).</p>
<p>Let’s look at a simple graph:</p>
</div>
<div id="6b821080-9dd1-4923-84e7-bb9e4cc439dd" class="cell code">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph <span class="im">as</span> GVDigraph</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> GVDigraph(<span class="st">&quot;example&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dot.attr(rankdir<span class="op">=</span><span class="st">'LR'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>vertices <span class="op">=</span> [<span class="st">'S'</span>, <span class="st">'1'</span>, <span class="st">'2'</span>, <span class="st">'3'</span>, <span class="st">'T'</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [(<span class="st">'S'</span>,<span class="st">'1'</span>),(<span class="st">'S'</span>,<span class="st">'2'</span>),(<span class="st">'1'</span>,<span class="st">'3'</span>),(<span class="st">'S'</span>,<span class="st">'3'</span>),(<span class="st">'2'</span>,<span class="st">'T'</span>),(<span class="st">'3'</span>,<span class="st">'T'</span>)]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> v <span class="kw">in</span> vertices:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  dot.node(v)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (a,b) <span class="kw">in</span> edges:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  dot.edge(a,b)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>dot</span></code></pre></div>
</div>
<div id="f1f9a154-0b45-4030-a887-4bf58efe6bf4" class="cell markdown">
<p>A vertex is a <em>source</em> if it only appears in outgoing edges, and a
vertex is a <em>sink</em> if it only appears in incoming edges.</p>
<p>In the preceding example, <code>S</code> is a source and <code>T</code> is a sink.</p>
</div>
<div id="ea8a7760-9c29-482c-99d2-5e4b89c6a41b" class="cell code">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph <span class="im">as</span> GVDigraph</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> linprog</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass, field</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">## &quot;standard basis vector&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sbv(index,size):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([<span class="fl">1.0</span> <span class="cf">if</span> i <span class="op">==</span> index <span class="cf">else</span> <span class="fl">0.0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size)])</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_indices(dat,length):</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">## dat is a list [(c,i).,,,] of pairs; the pair (c,i) determines</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">## the vector c*e_i where e_i is the ith standard basis vector</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">## from_indices(dat,length) function returns the sum of the vectors </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">## specified by the list dat</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>([c<span class="op">*</span>sbv(i,length) <span class="cf">for</span> (c,i) <span class="kw">in</span> dat],np.zeros(length))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">## &gt;&gt;&gt; from_indices([(2,3),(3.5,6)],7)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 0.,  0., 2., 0.,  0.,  3.5,  0.])</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flatten(ll : <span class="bu">list</span>[<span class="bu">list</span>[<span class="bu">any</span>]]) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">any</span>]:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [ i <span class="cf">for</span> l <span class="kw">in</span> ll <span class="cf">for</span> i <span class="kw">in</span> l ]</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UpperBound:</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    bound: <span class="bu">int</span> <span class="op">=</span> math.inf</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LowerBound:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    bound: <span class="bu">int</span> <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Edge:</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    vp: (<span class="bu">str</span>,<span class="bu">str</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    label: <span class="bu">str</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    val: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    bd: UpperBound <span class="op">|</span> LowerBound <span class="op">=</span> field(default<span class="op">=</span>UpperBound)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Digraph:</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    vertices: <span class="bu">list</span>[<span class="bu">list</span>[<span class="bu">str</span>]]</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    edges: <span class="bu">list</span>[Edge] </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> drawGraph(<span class="va">self</span>):</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> GVDigraph(<span class="va">self</span>.title)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        dot.attr(rankdir<span class="op">=</span><span class="st">'LR'</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vg <span class="kw">in</span> <span class="va">self</span>.vertices:</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dot.subgraph() <span class="im">as</span> c:</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>                c.attr(rank<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> x <span class="kw">in</span> vg:</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>                    c.node(x)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        vv <span class="op">=</span> flatten(<span class="va">self</span>.vertices)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.edges:</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>            a,b <span class="op">=</span> e.vp</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (a <span class="kw">in</span> vv) <span class="kw">and</span> (b <span class="kw">in</span> vv):</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>                dot.edge(a,b,label<span class="op">=</span><span class="bu">format</span>(e.label))</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dot</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> drawSubgraph(<span class="va">self</span>,vertices:<span class="bu">list</span>[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> GVDigraph(<span class="va">self</span>.title)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        dot.attr(rankdir<span class="op">=</span><span class="st">'LR'</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        vs <span class="op">=</span> vertices <span class="cf">if</span> vertices <span class="cf">else</span> flatten(<span class="va">self</span>.vertices)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> vs:</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>            dot.node(x)</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.edges:</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            a,b <span class="op">=</span> e.vp</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (a <span class="kw">in</span> vs) <span class="kw">and</span> (b <span class="kw">in</span> vs):</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>                dot.edge(a,b,label<span class="op">=</span><span class="bu">format</span>(e.label))</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dot</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getIncoming(<span class="va">self</span>,vertex: <span class="bu">str</span>):</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">filter</span>(<span class="kw">lambda</span> e: e.vp[<span class="dv">1</span>] <span class="op">==</span> vertex, <span class="va">self</span>.edges)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getOutgoing(<span class="va">self</span>,vertex: <span class="bu">str</span>):</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">filter</span>(<span class="kw">lambda</span> e: e.vp[<span class="dv">0</span>] <span class="op">==</span> vertex, <span class="va">self</span>.edges)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> edgeVector(<span class="va">self</span>,edge: Edge):</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="va">self</span>.edges.index(edge)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.edges)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sbv(i,N)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> conservationVector(<span class="va">self</span>,vertex: <span class="bu">str</span>):</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>        ivect <span class="op">=</span> np.<span class="bu">sum</span>([<span class="va">self</span>.edgeVector(e) <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.getIncoming(vertex)],axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>        ovect <span class="op">=</span> np.<span class="bu">sum</span>([<span class="va">self</span>.edgeVector(e) <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.getOutgoing(vertex)],axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ivect <span class="op">-</span> ovect</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> conservationLaw(<span class="va">self</span>,vertex: <span class="bu">str</span>):</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        ii <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x.label,<span class="va">self</span>.getIncoming(vertex)))</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        oo <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x.label,<span class="va">self</span>.getOutgoing(vertex)))</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;&quot;</span>.join([ii.<span class="fu">__repr__</span>(),</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot; - &quot;</span>,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>                        oo.<span class="fu">__repr__</span>(),</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot; = 0&quot;</span>])</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> edgeBounds(<span class="va">self</span>,edge: Edge):</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">match</span> edge.bd:</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> LowerBound(bound):</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> bound <span class="op">&gt;</span> <span class="op">-</span>math.inf:</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> ((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="va">self</span>.edgeVector(edge),(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>bound)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> UpperBound(bound):</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> bound <span class="op">&lt;</span> math.inf:</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> (<span class="va">self</span>.edgeVector(edge),bound)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> describeEdgeBound(<span class="va">self</span>,edge):</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">match</span> edge.bd:</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> LowerBound(bound):</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> bound <span class="op">&gt;</span> <span class="op">-</span>math.inf:</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> edge.label <span class="op">+</span> <span class="st">&quot;&gt;=&quot;</span> <span class="op">+</span> <span class="ss">f&quot;</span><span class="sc">{</span>bound<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> UpperBound(bound):</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> bound <span class="op">&lt;</span> math.inf:</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> edge.label <span class="op">+</span> <span class="st">&quot;&lt;=&quot;</span> <span class="op">+</span> <span class="ss">f&quot;</span><span class="sc">{</span>bound<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> allbounds(<span class="va">self</span>):</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        info <span class="op">=</span> [<span class="va">self</span>.edgeBounds(e) <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.edges ]</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        A_ub <span class="op">=</span> np.array([c[<span class="dv">0</span>] <span class="cf">for</span> c <span class="kw">in</span> info <span class="cf">if</span> c <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        b_ub <span class="op">=</span> np.array([c[<span class="dv">1</span>] <span class="cf">for</span> c <span class="kw">in</span> info <span class="cf">if</span> c <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (A_ub,b_ub)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> describeBounds(<span class="va">self</span>):</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        dd <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> e: <span class="va">self</span>.describeEdgeBound(e),<span class="va">self</span>.edges)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [d <span class="cf">for</span> d <span class="kw">in</span> dd <span class="cf">if</span> <span class="kw">not</span> d <span class="kw">is</span> <span class="va">None</span>]</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objectiveVector(<span class="va">self</span>):</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.<span class="bu">sum</span>([ e.val <span class="op">*</span> <span class="va">self</span>.edgeVector(e)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> e <span class="kw">in</span> <span class="va">self</span>.edges <span class="cf">if</span> e.val <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>],</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                      axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span>(kw_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> networkFlow(Digraph):</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    source: <span class="bu">str</span> </span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    sink: <span class="bu">str</span> </span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __post_init__(<span class="va">self</span>):</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        Digraph.<span class="fu">__init__</span>(<span class="va">self</span>,vertices<span class="op">=</span><span class="va">self</span>.vertices,edges<span class="op">=</span><span class="va">self</span>.edges,title<span class="op">=</span><span class="va">self</span>.title)</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> internalVertices(<span class="va">self</span>):</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [ v <span class="cf">for</span> v <span class="kw">in</span> flatten(<span class="va">self</span>.vertices) <span class="cf">if</span> <span class="kw">not</span> v <span class="kw">in</span> [ <span class="va">self</span>.source, <span class="va">self</span>.sink]]</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> conservationMatrix(<span class="va">self</span>):</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="va">self</span>.conservationVector(v) <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.internalVertices()]</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> conLaws(<span class="va">self</span>):</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="va">self</span>.conservationLaw(v) <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.internalVertices()]</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> runLinProgr(<span class="va">self</span>,maximize<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>        A_ub,b_ub <span class="op">=</span> <span class="va">self</span>.allbounds()</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>        A_eq <span class="op">=</span> <span class="va">self</span>.conservationMatrix()</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> maximize:</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="va">self</span>.objectiveVector()</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="va">self</span>.objectiveVector()</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> linprog(c,</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>                       A_eq<span class="op">=</span>A_eq,</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>                       b_eq<span class="op">=</span>np.zeros(<span class="bu">len</span>(<span class="va">self</span>.internalVertices())),</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>                       A_ub<span class="op">=</span>A_ub,</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>                       b_ub <span class="op">=</span> b_ub)</span></code></pre></div>
</div>
<div id="e8a4f83f-1022-4196-9309-98379a31b0d4" class="cell markdown">
<p>We can describe our previous example using this code:</p>
</div>
<div id="e37e61db-b937-49d9-8820-3037563747e7" class="cell code">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#vertices = ['S', '1', '2', '3', 'T']</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#edges = [('S','1'),('S','2'),('1','3'),('S','3'),('2','T'),('3','T')]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>vv <span class="op">=</span> [ [<span class="st">'S'</span>],[<span class="st">'1'</span>,<span class="st">'2'</span>],[<span class="st">'3'</span>],[<span class="st">'T'</span>]] </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>ee <span class="op">=</span> [ Edge((<span class="st">'S'</span>,<span class="st">'1'</span>),<span class="st">'g1'</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>       Edge((<span class="st">'S'</span>,<span class="st">'2'</span>),<span class="st">'g2'</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>       Edge((<span class="st">'S'</span>,<span class="st">'3'</span>),<span class="st">'g3'</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>       Edge((<span class="st">'1'</span>,<span class="st">'3'</span>),<span class="st">'g4'</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>       Edge((<span class="st">'2'</span>,<span class="st">'T'</span>),<span class="st">'g6'</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>       Edge((<span class="st">'3'</span>,<span class="st">'T'</span>),<span class="st">'g7'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>       ]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#nf = Digraph(vertices=vv,edges=ee)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>nf <span class="op">=</span> networkFlow(vertices<span class="op">=</span>vv,edges<span class="op">=</span>ee,title<span class="op">=</span><span class="st">'Example'</span>,source<span class="op">=</span><span class="st">'S'</span>,sink<span class="op">=</span><span class="st">'T'</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>nf.<span class="bu">format</span><span class="op">=</span><span class="st">'png'</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>nf.drawGraph()</span></code></pre></div>
</div>
<div id="7b8c35f0-17d9-4316-a365-6c0b5796c5ec" class="cell code">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nf.runLinProgr()</span></code></pre></div>
</div>
<div id="95fd37b5-ea8f-4042-9a99-6c17291d2e3d" class="cell markdown">
<h1 id="restaurant-example">Restaurant Example</h1>
<p>Suppose that you are opening a new restaurant and need to make sure you
have enough clean tablecloths to meet expected demand in the first week.
On each day, you can buy new tablecloths for \$ 5. Used tablecloths
can be laundered and returned the next day for \$2 or the following
day for $1.</p>
<p>Your expected tablecloth demands are:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Day</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;">5</th>
<th style="text-align: left;">6</th>
<th style="text-align: left;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">tablecloths needed</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">30</td>
</tr>
</tbody>
</table>
<p>Let’s try to formulate a linear program to minimize the costs.</p>
<p>Let’s name the quantities from the table.</p>
<ul>
<li><span class="math inline">\(t_i\)</span> = expected # of tablecloths required on day <span class="math inline">\(i\)</span>.</li>
</ul>
<p>Now introduce variables:</p>
<ul>
<li><span class="math inline">\(b_i\)</span> = # tablecloths bought on day <span class="math inline">\(i\)</span>, <span class="math inline">\(1 ≤ i ≤ 7\)</span>.</li>
<li><span class="math inline">\(f_i\)</span> = # dirty tablecloths sent to fast laundry on day <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(s_i\)</span> = # dirty tablecloths sent to slow laundry on day <span class="math inline">\(i\)</span></li>
</ul>
<p>First, let’s write down the objective (assuming we only care about week
1):</p>
<p>The goal is to minimize the quantity</p>
<p><span class="math display">\[5 \sum_{i=1}^7 b_i + 2\sum_{i=1}^6 f_i + \sum_{i=1}^5 s_i.\]</span></p>
<p>What are the constraints? On day <span class="math inline">\(i\)</span>, we must have at least <span class="math inline">\(t_i\)</span>
tablecloths available.</p>
<ul>
<li><p>day 1</p>
<p>we need enough tablecloths for day 1, so <span class="math display">\[t_1 \le b_1\]</span></p></li>
<li><p>day 2</p>
<p>demand must be met from purchases on day 2, plus surplus from day 1,
plus fast laundry from day 1. note that the <em>use</em> on day 1 is equal
to <span class="math inline">\(f_1 + s_1\)</span> and thus <span class="math inline">\(b_1 - f_1 - s_1\)</span> counts the surplus from
day 1. So we need</p>
<p><span class="math display">\[t_2 \le b_2 + (b_1 - f_1 - s_1) + f_1\]</span></p></li>
<li><p>day 3</p>
<p>demand must again be met from purchases on day 3, plus leftover from
the previous days, plus those laundered from the fast service on day
2, and those laundered via the slow service on day 1. The total used
in the first two days is equal to <span class="math inline">\(f_1 + s_1 + f_2 + s_2\)</span>, so the
surplus from the first two days is
<span class="math inline">\(b_1 + b_2 - f_1 - s_1 - f_2 - s_2\)</span>. So we need</p>
<p><span class="math display">\[t_3 \le b_3 + (b_1 + b_2 - f_1 - s_1 - f_2 - s_2) + f_2 + s_1\]</span></p></li>
</ul>
<p>etc.</p>
<p>This becomes increasingly hard to keep track of and formulate.</p>
<p>So, instead, we build what’s called a network model and we track the
flow of tablecloths!</p>
<p>Let’s use a tool called <code>graphviz</code> to draw part of a diagram:</p>
</div>
<div id="6e73f96c-a3b1-4175-92a9-2e851c4802df" class="cell code">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tt <span class="op">=</span> np.array([<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">40</span>,<span class="dv">30</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>clean <span class="op">=</span> [ <span class="ss">f&quot;d</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss"> clean&quot;</span> <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>) ]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>used  <span class="op">=</span> [ <span class="ss">f&quot;d</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss"> used&quot;</span>  <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>) ]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>vv <span class="op">=</span> [[<span class="st">'source'</span>], clean, used]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ee <span class="op">=</span> [<span class="op">*</span>[ Edge((<span class="st">'source'</span>,clean[d]),   label<span class="op">=</span><span class="ss">f&quot;b</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">&quot;</span>, val<span class="op">=</span><span class="dv">5</span>) <span class="co"># bought</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>[ Edge((clean[d],used[d]),    label<span class="op">=</span><span class="ss">f&quot;u</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">&quot;</span>, bd<span class="op">=</span>LowerBound(tt[d])) <span class="co"># usage</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>[ Edge((clean[d],clean[d<span class="op">+</span><span class="dv">1</span>]), label<span class="op">=</span><span class="ss">f&quot;c</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">&quot;</span> )       <span class="co"># carry-over</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>       ],</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>[ Edge((used[d],clean[d<span class="op">+</span><span class="dv">1</span>]),  label<span class="op">=</span><span class="ss">f&quot;f</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">&quot;</span>, val<span class="op">=</span><span class="dv">2</span>) <span class="co"># fast laundry</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>       ], </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>[ Edge((used[d],clean[d<span class="op">+</span><span class="dv">2</span>]),  label<span class="op">=</span><span class="ss">f&quot;s</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">&quot;</span>, val<span class="op">=</span><span class="dv">1</span>) <span class="co"># slow laundry</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>       ]</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> report(nf: networkFlow) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    lp<span class="op">=</span>nf.runLinProgr()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> lp.x</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> lp.fun</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;linprog succeeded? </span><span class="sc">{</span>lp<span class="sc">.</span>success<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>         <span class="ss">f&quot;Optimal tablecloth expenses for the week are $</span><span class="sc">{</span>costs<span class="sc">:.2f}</span><span class="ss">&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;This is achieved by the following strategy:&quot;</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>[<span class="ss">f&quot;purchase on day </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;&quot;</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>[<span class="ss">f&quot;use on day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">6</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;&quot;</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>[<span class="ss">f&quot;carry-over from day </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> to day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">13</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)],</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;&quot;</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>[<span class="ss">f&quot;fast laundry on day </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">19</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)],</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;&quot;</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>[<span class="ss">f&quot;slow laundry on day </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">25</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)],</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>         ])</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>nf <span class="op">=</span> networkFlow(vv,ee,title<span class="op">=</span><span class="st">&quot;Restaurant&quot;</span>,source<span class="op">=</span><span class="st">'source'</span>,sink<span class="op">=</span><span class="st">'d6 used'</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>nf.makeGraph().render()</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(report(nf))</span></code></pre></div>
</div>
<div id="10c2bcf1-00c1-4999-b5c7-c6d71093dc23" class="cell code">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## https://www.graphviz.org/</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">## https://graphviz.readthedocs.io/en/stable/index.html</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_node(day):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;d</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">c&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> used_node(day):</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;d</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">u&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_network_model(last):</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>   dot <span class="op">=</span> Digraph(<span class="st">'tablecloth network model'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>   dot.attr(rankdir<span class="op">=</span><span class="st">'LR'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>   dot.node(<span class="st">'s'</span>,<span class="st">'source of new tablecloths'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>   days <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,last <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>   <span class="cf">with</span> dot.subgraph(name<span class="op">=</span><span class="st">'clean'</span>) <span class="im">as</span> c:</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>     c.attr(rank<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> day <span class="kw">in</span> days:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> day <span class="op">==</span> last:</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            c.node(clean_node(day),<span class="st">&quot;etc...&quot;</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            c.node(clean_node(day), <span class="ss">f&quot;day </span><span class="sc">{</span>day<span class="sc">}</span><span class="ss"> clean&quot;</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>   <span class="cf">with</span> dot.subgraph(name<span class="op">=</span><span class="st">'used'</span>) <span class="im">as</span> u:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>     u.attr(rank<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> day <span class="kw">in</span> days:</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> day <span class="op">==</span> last:</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            u.node(used_node(day),<span class="st">'etc...'</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            u.node(used_node(day), <span class="ss">f&quot;day </span><span class="sc">{</span>day<span class="sc">}</span><span class="ss"> used&quot;</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> day <span class="kw">in</span> days:</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>     dot.edge(<span class="st">'s'</span>,clean_node(day),label<span class="op">=</span><span class="st">'cost=5'</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> day <span class="op">&lt;</span> last:</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        dot.edge(clean_node(day),clean_node(day<span class="op">+</span><span class="dv">1</span>), label <span class="op">=</span> <span class="st">&quot;cost=0&quot;</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>     dot.edge(clean_node(day),used_node(day),label<span class="op">=</span><span class="ss">f&quot;cost=0,ℓ=t_</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> day <span class="op">&lt;</span> last:</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        dot.edge(used_node(day),clean_node(day<span class="op">+</span><span class="dv">1</span>),label<span class="op">=</span><span class="st">&quot;cost=2&quot;</span>) <span class="co">## fast laundry</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> day <span class="op">&lt;</span> last <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        dot.edge(used_node(day),clean_node(day<span class="op">+</span><span class="dv">2</span>),label<span class="op">=</span><span class="st">&quot;cost=1&quot;</span>) <span class="co">## slow laundry</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> dot</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>make_network_model(last<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="01b8d31d-462f-47a5-b80f-20434cfd2842" class="cell markdown">
<p>(extrapolate the diagram for the remaining days…)</p>
<hr />
<p>How do we make a linear program of this??</p>
<p>The above diagram represents a <em>directed graph</em>. The edges in this graph
– i.e. the arrows between nodes – track the “flow” of tablecloths.</p>
<ul>
<li><p>We introduce a variable for each arrow. The value of the variable
represents the number of tablecloths that move from the start to
finish of the arrow.</p></li>
<li><p>Some arcs have lower bounds (e.g. <span class="math inline">\(\ell\)</span> = t_1). If no lower bound
is mentioned, there is an implied lower bound of 0.</p></li>
<li><p>Some arcs have upper bounds. These model maximum supply or
throughput. Nothing implies a bound of <span class="math inline">\(\infty\)</span>.</p></li>
<li><p>Each “internal” node has conservation –
i.e. <code>outputs - inputs =   0</code>.</p></li>
<li><p>Each arc has a cost. The Objective function is the sum of the
quantities (arc costs <span class="math inline">\(\times\)</span> flow variable).</p></li>
</ul>
</div>
<div id="922338ce-5ea6-4af4-b44e-32c997099dc4" class="cell markdown">
<p>Remember that we write</p>
<ul>
<li><p><span class="math inline">\(t_i\)</span> = # tablecloths needed on day <span class="math inline">\(i\)</span>.</p>
<p>(these aren’t <em>variables</em> for our linear program – they are values
given to us by the problem).</p></li>
</ul>
<p>Since we are to have one variable for each arrow in the above diagram,
we write:</p>
<ul>
<li><span class="math inline">\(b_i\)</span> = # tablecloths bought on day <span class="math inline">\(i, 1 ≤ i ≤ 7\)</span>.</li>
<li><span class="math inline">\(u_i\)</span> = # tablecloths used on day <span class="math inline">\(i, 1 ≤ i ≤ 7\)</span>.</li>
<li><span class="math inline">\(c_i\)</span> = # tablecloths carried over from day <span class="math inline">\(i\)</span> to <span class="math inline">\(i + 1\)</span> for
<span class="math inline">\(0 \le i \le 6\)</span></li>
<li><span class="math inline">\(f_i\)</span> = # dirty tablecloths sent to fast laundry on day <span class="math inline">\(i\)</span> for
<span class="math inline">\(0 \le i \le 6\)</span></li>
<li><span class="math inline">\(s_i\)</span> = # dirty tablecloths sent to slow laundry on day <span class="math inline">\(i\)</span> for
<span class="math inline">\(0 \le i \le 5\)</span></li>
</ul>
<p>Now the objective equation has the form:</p>
<p><span class="math display">\[5\sum_{i=1}^7 b_i + 0 \sum_{i=1}^7 u_i + 0 \sum_{i=1}^6 c_i + 2
\sum_{i=1}^6 f_i + \sum_{i=1}^5 s_i\]</span></p>
<p>We require <span class="math inline">\(t_i \le u_i\)</span> for <span class="math inline">\(1 \le i \le 7\)</span> (lower bounds). These lower
bounds arise from the arrows from “Day i clean” to “Day i used” with the
label <span class="math inline">\(\ell = t_i\)</span>.</p>
<p>We impose no upper bounds on the variables.</p>
<p>For each node, we get a conservation equation:</p>
<ul>
<li>node “day 1 clean”: <span class="math inline">\(u_1 + c_1 − b_1 = 0\)</span></li>
<li>node “day 1 used”: <span class="math inline">\(s_1 + f_1 − u_1 = 0\)</span></li>
<li>node “day 2 clean”: <span class="math inline">\(u_2 + c_2 − b_2 − c_1 − f_1 = 0\)</span></li>
<li>node “day 2 used”: <span class="math inline">\(s_2 + f_2 − u_2 = 0\)</span></li>
<li>node “day 3 clean”: <span class="math inline">\(u_3 + c_3 − b_3 − c_2 − f_2 − s_1 = 0\)</span></li>
<li>node “day 3 used”: <span class="math inline">\(s_3 + f_3 − u_3 = 0\)</span></li>
<li>and so on…</li>
</ul>
<p>Note for example that 2 arrows leave and 3 arrows arrive at the node
“Day 2 clean”, while 2 arrows leave and 4 arrows arrive at the node “Day
3 clean”. The above equations reflect these counts.</p>
</div>
<div id="79502e36-fa52-40e4-8461-7d1598ef80cf" class="cell markdown">
<h2 id="remarks">Remarks:</h2>
<ul>
<li><p>There are <span class="math inline">\(2 \times 7 + 2 \times 6 + 5 = 31\)</span> variables. So the
objective function is given by a vector
<span class="math inline">\(\mathbf{c} \in \mathbb{R}^{1 \times 31}\)</span>.</p></li>
<li><p>there are 13 “equality constraints” arising from the conservation
equation at each node (note that there is no conservation at the
node “day 7 used”, since it is a terminal node). Thus the equality
constraints are given by a <span class="math inline">\(13 \times 31\)</span> matrix <span class="math inline">\(A\)</span> (they amount to
the condition <span class="math inline">\(A\mathbf{x} = \mathbf{0}\)</span> for
<span class="math inline">\(\mathbf{x} \in \mathbb{R}^{31} = \mathbb{R}^{31 \times 1}\)</span>).</p></li>
<li><p>there are 7 inequality constraints, given by the condition
<span class="math inline">\(B \mathbf{x} \le \mathbf{b}\)</span> for a <span class="math inline">\(7 \times 31\)</span> matrix <span class="math inline">\(B\)</span> and a
vector <span class="math inline">\(\mathbf{b} \in \mathbb{R}^7 = \mathbb{R}^{7 \times 1}\)</span>.</p></li>
</ul>
</div>
<div id="1c3ebc91-7ede-486c-9294-d7e860672f7c" class="cell markdown">
<h2 id="implementation-sketch">Implementation (sketch)</h2>
<p>The main task in solving this model via <code>python</code> is producing the
matrices <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>.</p>
<p>For example, the conservation at the node</p>
<ul>
<li>node “day 3 clean”: <span class="math inline">\(u_3 + c_3 − b_3 − c_2 − f_2 − s_1 = 0\)</span></li>
</ul>
<p>results in a <em>row</em> of the matrix <span class="math inline">\(A\)</span>.</p>
<p>Let’s order the variables as follows:
<span class="math display">\[b_1,b_2,\dots,b_7,u_1,\dots,u_7,c_1,\dots,c_6,f_1,\dots,f_6,s_1,\dots,s_5\]</span></p>
<p>We want to write rows of <span class="math inline">\(A\)</span> in the form</p>
<p><span class="math display">\[(\heartsuit) \quad \begin{bmatrix} \mathbf{\widetilde b} &amp;
\mathbf{\widetilde u} &amp; \mathbf{\widetilde c} &amp; \mathbf{\widetilde f}
&amp; \mathbf{\widetilde s} \\ \end{bmatrix} \in \mathbb{R}^{1 \times
31}\]</span></p>
<p>where</p>
<p><span class="math display">\[\mathbf{\widetilde b},\mathbf{\widetilde u} \in \mathbb{R}^{1 \times
7}, \quad \mathbf{\widetilde c},\mathbf{\widetilde f} \in
\mathbb{R}^{1 \times 6}, \quad \mathbf{\widetilde s} \in \mathbb{R}^{1
\times 5},\]</span></p>
<p>the row vector <span class="math inline">\((\heartsuit)\)</span> is to be understood as obtained by
“<em>concatenation</em>” of these vectors, and we have:</p>
<p><span class="math display">\[\mathbf{\widetilde b} = \begin{bmatrix} 0 &amp; 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 &amp; 0
\end{bmatrix} = -\mathbf{e}_3, \quad \mathbf{\widetilde u} =
\mathbf{e}_3,\]</span></p>
<p><span class="math display">\[\mathbf{\widetilde c} = \begin{bmatrix} 0 &amp; -1 &amp; 1 &amp; 0 &amp; 0 &amp; 0
\end{bmatrix} = \mathbf{e}_3 -\mathbf{e}_2, \quad \mathbf{\widetilde f} =
\begin{bmatrix} 0 &amp; -1 &amp; 0 &amp; 0 &amp; 0 \end{bmatrix} = -\mathbf{e}_2,
\quad\mathbf{\widetilde s} = -\mathbf{e}_1\]</span></p>
<p>(here <span class="math inline">\(\mathbf{e}_i\)</span> represents the appropriate standard basis vector in
<span class="math inline">\(\mathbb{R}^7\)</span>, <span class="math inline">\(\mathbb{R}^6\)</span> or <span class="math inline">\(\mathbb{R}^5\)</span>).</p>
</div>
<div id="0c2c20de-a2d9-411d-a523-981414193237" class="cell code">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">## This code represents a preliminary implementation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">## it just gives the row in the equality constraint corresponding</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">## to a single row. See the next cell for a &quot;full implementation&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sbv(index,length):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([<span class="fl">1.0</span> <span class="cf">if</span> i <span class="op">==</span> index<span class="op">-</span><span class="dv">1</span> <span class="cf">else</span> <span class="fl">0.0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(length)])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">## produce the row corresponding to the &quot;day 3 clean&quot; node.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>row <span class="op">=</span> np.block([(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>sbv(<span class="dv">3</span>,<span class="dv">7</span>), <span class="co">## bb</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                 sbv(<span class="dv">3</span>,<span class="dv">7</span>),       <span class="co">## uu</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                 (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>sbv(<span class="dv">2</span>,<span class="dv">6</span>) <span class="op">+</span> sbv(<span class="dv">3</span>,<span class="dv">6</span>),  <span class="co">## cc</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                 (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>sbv(<span class="dv">2</span>,<span class="dv">6</span>),       <span class="co">## ff</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                 (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>sbv(<span class="dv">1</span>,<span class="dv">5</span>)       <span class="co">## ss</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>               ])</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Note that if you had constructed the following rows -- row1, row2, row3, ..., row7 -- you'd produce the matrix A via</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">## A = np.array([row1,row2,row3,...,row7])</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(row.shape)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(row)</span></code></pre></div>
</div>
<div id="e682dbfa-fdae-4677-8973-e9247e916386" class="cell code">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">## This cell represents one possible way of creating the equality and inquality constraints</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">## for the &quot;tablecloth&quot; problem</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> linprog</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>float_formatter <span class="op">=</span> <span class="st">&quot;</span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(formatter<span class="op">=</span>{<span class="st">'float_kind'</span>:float_formatter})</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">## &quot;standard basis vector&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sbv(index,size):</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([<span class="fl">1.0</span> <span class="cf">if</span> i <span class="op">==</span> index<span class="op">-</span><span class="dv">1</span> <span class="cf">else</span> <span class="fl">0.0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size)])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_indices(dat,length):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">## dat is a list [(c,i).,,,] of pairs; the pair (c,i) determines</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">## the vector c*e_i where e_i is the ith standard basis vector</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">## from_indices(dat,length) function returns the sum of the vectors </span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">## specified by the list dat</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>([c<span class="op">*</span>sbv(i,length) <span class="cf">for</span> (c,i) <span class="kw">in</span> dat],np.zeros(length))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">## &gt;&gt;&gt; from_indices([(2,3),(3.5,6)],7)</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 0.,  0., 2., 0.,  0.,  3.5,  0.])</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> row(b<span class="op">=</span>[],</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        u<span class="op">=</span>[],</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>[],</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        f<span class="op">=</span>[],</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span>[]):</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    bb <span class="op">=</span> from_indices(b,<span class="dv">7</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    uu <span class="op">=</span> from_indices(u,<span class="dv">7</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> from_indices(c,<span class="dv">6</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    ff <span class="op">=</span> from_indices(f,<span class="dv">6</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    ss <span class="op">=</span> from_indices(s,<span class="dv">5</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.block([bb,uu,cc,ff,ss])</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">## &gt;&gt;&gt; row(bp=[1],un=[2])</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 1.,  0.,  0.,  0.,  0.,  0.,  0.,  0., -1.,  0.,  0.,  0.,  0.,</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">##        0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">##        0.,  0.,  0.,  0.,  0.])</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">## this result has a 1 in the &quot;1st entry of the b-group&quot; and a -1 in</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">## the &quot;2nd entry of the u-group&quot;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co">## here is a textual description of the &quot;equality constraint&quot; matrix.</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co">## We then proceed to implement this description using the function `row` </span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co">## defined above.</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co">## day1 clean: b1 - u1 - c1 = 0</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co">## day2 clean: b2 + c1 + f1 - u2 - c2 = 0</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co">## day3 clean: b3 + c2 + s1 + f2 - u3 - c3 = 0</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="co">## day4 clean: b4 + c3 + s2 + f3 - u4 - c4 = 0</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="co">## day5 clean: b5 + c4 + s3 + f4 - u5 - c5 = 0</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co">## day6 clean: b6 + c5 + s4 + f5 - u6 - c6 = 0</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">## day7 clean: b7 + c6 + s5 + f6 - u7 = 0</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co">## day1 used:  u1 - s1 - f1  = 0</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co">## day2 used:  u2 - s2 - f2  = 0</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co">## day3 used:  u3 - s3 - f3  = 0</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">## day4 used:  u4 - s4 - f4  = 0</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co">## day5 used:  u5 - s5 - f5  = 0</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">## day6 used:  u6 - f6   = 0</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co">## Note that day7 used is a &quot;terminal node&quot; so doesn't have a conservation equation.</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="co">## the rc are rows corresponding to conservation laws for &quot;clean&quot; nodes</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>rc1 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],c<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)],                   u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)])</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>rc2 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">2</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>)],          f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>rc3 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">3</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">2</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">3</span>)],s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">2</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">3</span>)])</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>rc4 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">4</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">3</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>)],s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">2</span>)],f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">3</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>)])</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>rc5 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">5</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">4</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>)],s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">3</span>)],f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">4</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>rc6 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">6</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">5</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">6</span>)],s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">4</span>)],f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">5</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">6</span>)])</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>rc7 <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">7</span>)],c<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">6</span>),(<span class="op">-</span><span class="dv">1</span>,<span class="dv">7</span>)],s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">5</span>)],f<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">6</span>)],u<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">7</span>)])</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co">## the ru are rows corresponding to conservation laws for &quot;used&quot; nodes</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>ru1 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],s<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)],f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)])</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>ru2 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">2</span>)],s<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>)],f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>ru3 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">3</span>)],s<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">3</span>)],f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">3</span>)])</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>ru4 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">4</span>)],s<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>)],f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>)])</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>ru5 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">5</span>)],s<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>)],f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>ru6 <span class="op">=</span> row(u<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">6</span>)],           f<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">6</span>)])</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="co">## the rc and ru determined the rows of the matrix defining </span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>Aeq <span class="op">=</span> np.array([rc1,rc2,rc3,rc4,rc5,rc6,rc7,</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>                ru1,ru2,ru3,ru4,ru5,ru6])</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>Alb <span class="op">=</span> np.array([row(u<span class="op">=</span>[(<span class="dv">1</span>,i)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">8</span>)])</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co">## objective function</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> row(b<span class="op">=</span>[(<span class="dv">5</span>,<span class="dv">1</span>),(<span class="dv">5</span>,<span class="dv">2</span>),(<span class="dv">5</span>,<span class="dv">3</span>),(<span class="dv">5</span>,<span class="dv">4</span>),(<span class="dv">5</span>,<span class="dv">5</span>),(<span class="dv">5</span>,<span class="dv">6</span>),(<span class="dv">5</span>,<span class="dv">7</span>)],</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>        f<span class="op">=</span>[(<span class="dv">2</span>,<span class="dv">1</span>),(<span class="dv">2</span>,<span class="dv">2</span>),(<span class="dv">2</span>,<span class="dv">3</span>),(<span class="dv">2</span>,<span class="dv">4</span>),(<span class="dv">2</span>,<span class="dv">5</span>),(<span class="dv">2</span>,<span class="dv">6</span>)],</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>),(<span class="dv">1</span>,<span class="dv">2</span>),(<span class="dv">1</span>,<span class="dv">3</span>),(<span class="dv">1</span>,<span class="dv">4</span>),(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>tt <span class="op">=</span> np.array([<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">40</span>,<span class="dv">30</span>]) <span class="co">## these are the ti entries taken from the &quot;tablecloths needed&quot; table</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="co">## use linprog to find the point which minimizes the objective function</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="co">## we impose equality constraints  Aeq*x=0.</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="co">## we also want the inequality constraint Ax &gt;= tt, so we use -Ax &lt;= -tt.</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> linprog(c,A_eq<span class="op">=</span>Aeq,b_eq<span class="op">=</span>np.zeros(<span class="dv">13</span>),A_ub<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>Alb,b_ub<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>tt)</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> report(result):</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">## the argument ``result`` should be an instance of the class ``scipy.optimize.OptimizeResult`` -- </span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">## i.e. a value of the form returned by ``linprog``</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">##</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> result.x</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> result.fun</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;linprog succeeded? </span><span class="sc">{</span>result<span class="sc">.</span>success<span class="sc">}</span><span class="ss">&quot;</span>]</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;Optimal costs on tablecloths for the week are $</span><span class="sc">{</span>costs<span class="sc">:.2f}</span><span class="ss">&quot;</span>]</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&quot;This is achieved by the following strategy:</span><span class="ch">\n</span><span class="st">&quot;</span>]</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;purchase on day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&quot;&quot;</span>]</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;use on day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">7</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&quot;&quot;</span>]</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;carry over from day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> to day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">2</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">14</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&quot;&quot;</span>]        </span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;to fast laundry on day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">20</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&quot;&quot;</span>]        </span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> </span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>        [<span class="ss">f&quot;to slow laundry on day </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[<span class="dv">26</span><span class="op">+</span>i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)])</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(report(result))</span></code></pre></div>
</div>
<div id="041bb4a5-43e4-4cd5-b3d9-d72709a09c00" class="cell markdown">
<p>The idea is that “network flow” graphs are a tool to help formulate the
linear program. Here is another example.</p>
<h1 id="grocery-example">Grocery example</h1>
<p>A fruit wholesaler buys and sells apples according to the following
prices and demand:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Month</th>
<th style="text-align: right;">Aug</th>
<th style="text-align: right;">Sep</th>
<th style="text-align: right;">Oct</th>
<th style="text-align: right;">Nov</th>
<th style="text-align: right;">Dec</th>
<th style="text-align: right;">Jan</th>
<th style="text-align: right;">Feb</th>
<th style="text-align: right;">Mar</th>
<th style="text-align: right;">Apr</th>
<th style="text-align: right;">May</th>
<th style="text-align: right;">Jun</th>
<th style="text-align: right;">Jul</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">price/kg from grower</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">sale price/kg</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">demand in 1000kg</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
<p>The wholesaler can store 50,000kg at a cost of $0.025 per kg per month.
Unlimited supplies are available from September to January but only
15,000kg are available in August and February and none during the rest
of the year.</p>
<p>We consider the profit for a year (12 months), from August to the next
July. We suppose that there are <em>no</em> apples to carry over from the
previous month – we begin with no apples.</p>
<p>Our goal: Maximize the profit!</p>
</div>
<div id="76586f7b-226c-4de5-811b-50208f70ed94" class="cell markdown">
<p>We’ll begin by formulating the flow model.</p>
<p>Remember that each edge in the graph corresponds to a variable in our
linear program. We are going to label each edge with a symbol
<span class="math inline">\([c,u,\ell]\)</span> representing the “cost” (i.e. the contribution of that
variable to the objective function), an upper bound <span class="math inline">\(u\)</span> for that
variable, and a lower bound <span class="math inline">\(\ell\)</span> for that variable.</p>
<p>We are going to construct the diagram using <code>graphviz</code>, though the main
point here is the diagram itself rather than the code used to produce
it. (I’m including the code so you can copy it if you wish).</p>
</div>
<div id="f5eda9d8-6412-4901-a124-19f12582095b" class="cell code">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">## https://www.graphviz.org/</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">## https://graphviz.readthedocs.io/en/stable/index.html</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> Digraph(<span class="st">'fruit wholesaler model'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>dot.attr(rankdir<span class="op">=</span><span class="st">'LR'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>dot.node(<span class="st">'g'</span>,<span class="st">'grower'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> dot.subgraph(name<span class="op">=</span><span class="st">'months'</span>) <span class="im">as</span> c:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    c.attr(rank<span class="op">=</span><span class="st">'same'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'aug'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'sep'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'oct'</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'nov'</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'feb'</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    c.node(<span class="st">'mar'</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>dot.node(<span class="st">'d'</span>,<span class="st">'demand'</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'g'</span>,<span class="st">'aug'</span>,label<span class="op">=</span><span class="st">'[-.8,15000,0]'</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'g'</span>,<span class="st">'sep'</span>,label<span class="op">=</span><span class="st">'[-.55,∞,0]'</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'g'</span>,<span class="st">'oct'</span>,label<span class="op">=</span><span class="st">'[-.55,∞,0]'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'g'</span>,<span class="st">'nov'</span>,label<span class="op">=</span><span class="st">'[-.65,∞,0]'</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'g'</span>,<span class="st">'feb'</span>,label<span class="op">=</span><span class="st">'[-.95,15000,0]'</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'aug'</span>,<span class="st">'sep'</span>,label<span class="op">=</span><span class="st">'[-0.025,50K,0]'</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'sep'</span>,<span class="st">'oct'</span>,label<span class="op">=</span><span class="st">'[-0.025,50K,0]'</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'oct'</span>,<span class="st">'nov'</span>,label<span class="op">=</span><span class="st">'[-0.025,50K,0]'</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'feb'</span>,<span class="st">'mar'</span>,label<span class="op">=</span><span class="st">'[-0.025,50K,0]'</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'aug'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[0.9,10000,0]'</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'sep'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[0.65,15000,0]'</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'oct'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[0.65,15000,0]'</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'nov'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[0.85,15000,0]'</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'feb'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[1.20,10000,0]'</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>dot.edge(<span class="st">'mar'</span>,<span class="st">'d'</span>,label<span class="op">=</span><span class="st">'[1.20,10000,0]'</span>)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>dot</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">#dot.format='png'</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">#dot.render()</span></span></code></pre></div>
</div>
<div id="47e5531c-fea2-4974-9088-a0f6871b4d0b" class="cell markdown">
<p>Now let’s formulate the linear program.</p>
<p>Let’s number our months in a slightly odd way. Our year starts in
<code>august</code>, so we number as follows:</p>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"><code>aug</code></th>
<th style="text-align: right;"><code>sep</code></th>
<th style="text-align: right;"><code>oct</code></th>
<th style="text-align: right;"><code>nov</code></th>
<th style="text-align: right;"><code>dec</code></th>
<th style="text-align: right;"><code>jan</code></th>
<th style="text-align: right;"><code>feb</code></th>
<th style="text-align: right;"><code>mar</code></th>
<th style="text-align: right;"><code>apr</code></th>
<th style="text-align: right;"><code>may</code></th>
<th style="text-align: right;"><code>jun</code></th>
<th style="text-align: right;"><code>jul</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
<p>We need to name our variables; we’ll use the above numbering:</p>
<ul>
<li><span class="math inline">\(g_i\)</span> = # kg bought in month <span class="math inline">\(i\)</span>, for <span class="math inline">\(1 \le i \le 12\)</span>.</li>
<li><span class="math inline">\(s_i\)</span> = # kg stored from month <span class="math inline">\(i\)</span> to month <span class="math inline">\(i+1\)</span></li>
<li><span class="math inline">\(d_i\)</span> = # kg sold in month <span class="math inline">\(i\)</span></li>
</ul>
<p>All of our variables are assumed to be non-negative:
<span class="math inline">\(g_i \ge 0, s_i \ge 0, d_i \ge 0\)</span> for all <span class="math inline">\(i\)</span>.</p>
<p>We’ve been told the following:</p>
<blockquote>
<p>Unlimited supplies are available (from the grower) from September to
January but only 15,000kg are available in August and February and
none during the rest of the year.</p>
</blockquote>
<p>This gives us some “upper bound” inequalities:</p>
<p><span class="math display">\[\begin{bmatrix}
    g_1 \\ g_2 \\ g_3 \\ g_4 \\ g_5 \\ g_6 \\ 
    \end{bmatrix}
    \le 
    \begin{bmatrix}
       1500 \\   
       \infty \\ 
       \infty \\ 
       \infty \\ 
       \infty \\
       \infty
    \end{bmatrix}
    \quad \text{and} \quad
    \begin{bmatrix}
    g_7 \\ g_8 \\ g_9 \\ g_{10} \\ g_{11} \\ g_{12}
    \end{bmatrix}
    \le 
    \begin{bmatrix}
    15000 \\
    0 \\
    0 \\
    0 \\
    0 \\
    0
    \end{bmatrix}\]</span></p>
<p>(since <span class="math inline">\(g_i \ge 0\)</span> is non-negative, the above conditions for
<span class="math inline">\(8 \le i \le 12\)</span> <em>amount to</em> an equality condition of <span class="math inline">\(g_i = 0\)</span> for
these <span class="math inline">\(i\)</span>, but we’ll enter it as an inequality condition for
uniformity).</p>
<p>We’ve also been told:</p>
<blockquote>
<p>The wholesaler can store 50,000kg at a cost of $0.025 per kg per
month.</p>
</blockquote>
<p>This yields the upper bound - <span class="math inline">\(s_i \le 50000\)</span> for <span class="math inline">\(1 \le i \le 12\)</span></p>
<p>Now, we know from table the demand for each month. Remember what we are
doing: with the linear program, we are trying to decide the optimal
values of our decision variables – i.e. how many apples do we buy each
month? and how many apples do we store each month? According to the
model, the number of apples we expect to <em>sell</em> depends on these choices
(via the conservation laws). So to be sensible, our model must view the
anticipated demand (listed in the table) as an <strong>upper bound</strong> for the
amount we can sell. More precisely, we should impose the constraint that
the number <span class="math inline">\(d_i\)</span> of <code>kg</code> of apples delivered to customers is <span class="math inline">\(\le\)</span> the
anticipated demand for each month. (Of course, this is what the label on
the diagram indicates! Here I’m trying to explain why we have chosen
that labeling).</p>
<p>This amount to the condition: <span class="math display">\[\begin{bmatrix}
    d_1 \\ d_2 \\ d_3 \\ d_4 \\ d_5 \\ d_6 \\ 
    \end{bmatrix}
    \le 
    \begin{bmatrix}
       10 \\   
       15 \\ 
       15 \\ 
       15 \\ 
       13 \\
       10    \end{bmatrix}
    \quad \text{and} \quad
    \begin{bmatrix}
    d_7 \\ d_8 \\ d_9 \\ d_{10} \\ d_{11} \\ d_{12}
    \end{bmatrix}
    \le 
    \begin{bmatrix}
    10 \\
    10 \\
    9 \\
    7  \\
    5 \\
    5
    \end{bmatrix}\]</span></p>
<p>Conservation:</p>
<p>The internal nodes of our network flow diagram correspond to months. The
arrow “going in” to the node amount to available apples, and they
correspond to purchases (<span class="math inline">\(g_i\)</span>) and storage (<span class="math inline">\(s_{i-1}\)</span> unless <span class="math inline">\(i=1\)</span>).
The arrows going out correspond to storage (<span class="math inline">\(s_i\)</span>) and to apples
delivered to customers (<span class="math inline">\(d_i\)</span>). Thus, we must have</p>
<ul>
<li><span class="math inline">\(s_1 + d_1 - g_1 = 0\)</span></li>
<li><span class="math inline">\(s_2 + d_2 - g_2 - s_1 = 0\)</span>.</li>
<li><span class="math inline">\(s_3 + d_3 - g_3 - s_2 = 0\)</span>.</li>
<li><span class="math inline">\(\vdots\)</span></li>
</ul>
<p>Objective:</p>
<p>The objective function represents profit, and each variable has some
contribution to objective/profit function (we call this contribution
“cost”). We spend money through apple purchases and through storage
costs, and these costs have negative values. We get money through apple
sales, and these costs have positive value.</p>
<ul>
<li><p>August contribution to the objective function:</p>
<p><span class="math display">\[\begin{matrix} -0.80g_1 - 0.025s_1 + 0.9d_1 \end{matrix}\]</span></p></li>
<li><p>September contribution to the objective function:</p>
<p><span class="math display">\[\begin{matrix} -0.55g_1 - 0.025s_1 + 0.65d_1 \end{matrix}\]</span></p></li>
<li><p><span class="math inline">\(\cdots\)</span></p></li>
</ul>
<p>Of course, the objective function is the <em>sum</em> of all 12 of these
monthly contributions.</p>
<p>Implementation follows:</p>
</div>
<div id="ffd57d54-d831-4618-96ba-f76a457419ac" class="cell code">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> linprog</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>float_formatter <span class="op">=</span> <span class="st">&quot;</span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(formatter<span class="op">=</span>{<span class="st">'float_kind'</span>:float_formatter})</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">## &quot;standard basis vector&quot;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sbv(index,size):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([<span class="fl">1.0</span> <span class="cf">if</span> i <span class="op">==</span> index<span class="op">-</span><span class="dv">1</span> <span class="cf">else</span> <span class="fl">0.0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size)])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_indices(dat,length):</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">## dat is a list [(c,i).,,,] of pairs; the pair (c,i) determines</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">## the vector c*e_i where e_i is the ith standard basis vector</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>([c<span class="op">*</span>sbv(i,length) <span class="cf">for</span> (c,i) <span class="kw">in</span> dat],np.zeros(length))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> row(g<span class="op">=</span>[],</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span>[],</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        d<span class="op">=</span>[]):</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    gg <span class="op">=</span> from_indices(g,<span class="dv">12</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    ss <span class="op">=</span> from_indices(s,<span class="dv">12</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    dd <span class="op">=</span> from_indices(d,<span class="dv">12</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.block([gg,ss,dd])</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">## for uniformity, we actually consider 12 storage variables event though</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">## we shouldn't really put anything in storage in july (month 12)</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">## let's form the equality constraint matrix from the conservation laws.</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>A<span class="op">=</span>np.array([row(s<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],d<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)],g<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)])]     <span class="co"># first row</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>           <span class="op">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>           [row(s<span class="op">=</span>[(<span class="dv">1</span>,i),(<span class="op">-</span><span class="dv">1</span>,i<span class="op">-</span><span class="dv">1</span>)],</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                d<span class="op">=</span>[(<span class="dv">1</span>,i)],</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                g<span class="op">=</span>[(<span class="op">-</span><span class="dv">1</span>,i)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">13</span>)])   <span class="co"># remaining rows</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">## now let's make the inequality constraint matrix</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">## our inequality constraint will have the form Ax &lt;= b,</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">## so any &quot;lower bound&quot; constraints would need to be reversed using a sign change.</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">## But anyhow we haven't specified any lower bounds...</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>Bs <span class="op">=</span> [row(s<span class="op">=</span>[(<span class="dv">1</span>,i)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>)]</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>bs <span class="op">=</span> np.array([<span class="dv">50000</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>)])</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">## gi bounds</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>Bg_start <span class="op">=</span> [row(g<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">1</span>)]), row(g<span class="op">=</span>[(<span class="dv">1</span>,<span class="dv">7</span>)])]</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>Bg_end   <span class="op">=</span> [row(g<span class="op">=</span>[(<span class="dv">1</span>,i)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>,<span class="dv">13</span>)]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>Bg <span class="op">=</span> Bg_start <span class="op">+</span> Bg_end</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>bg <span class="op">=</span> np.array([<span class="dv">15000</span>,<span class="dv">15000</span>] <span class="op">+</span> <span class="dv">5</span><span class="op">*</span>[<span class="dv">0</span>])  <span class="co"># note that n*[0] is the list [0,0,...,0] with n zeros</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co">## di bounds</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>Bd <span class="op">=</span> [row(d<span class="op">=</span>[(<span class="dv">1</span>,i)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>)]</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>bd <span class="op">=</span> (<span class="dv">1000</span>)<span class="op">*</span>np.array([<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">13</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">5</span>])</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array(Bg <span class="op">+</span> Bs <span class="op">+</span> Bd) <span class="co">## concat the lists of rows; create a matrix from the resulting list</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.block([bg,bs,bd])   <span class="co">## concat the constraints</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co">## objective function</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>grower_costs <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>np.array([<span class="fl">0.8</span>,<span class="fl">0.55</span>,<span class="fl">0.55</span>,<span class="fl">0.65</span>,<span class="fl">0.75</span>,<span class="fl">0.85</span>,<span class="fl">0.95</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>storage_costs <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>np.array(<span class="dv">12</span><span class="op">*</span>[<span class="fl">.025</span>])</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>sale_price <span class="op">=</span> np.array([<span class="fl">0.9</span>,<span class="fl">0.65</span>,<span class="fl">0.65</span>,<span class="fl">0.85</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">1.2</span>,<span class="fl">1.2</span>,<span class="fl">1.2</span>,<span class="dv">1</span>,<span class="fl">.8</span>,<span class="fl">.8</span>])</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.block([grower_costs,storage_costs,sale_price])</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> linprog((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>c,A_eq<span class="op">=</span>A,b_eq<span class="op">=</span>np.zeros(<span class="dv">12</span>),A_ub<span class="op">=</span>B,b_ub<span class="op">=</span>b)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> month(i):</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">dict</span><span class="op">=</span>{<span class="dv">1</span>:<span class="st">&quot;aug&quot;</span>,</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>:<span class="st">&quot;sep&quot;</span>,</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>          <span class="dv">3</span>:<span class="st">&quot;oct&quot;</span>,</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>          <span class="dv">4</span>:<span class="st">&quot;nov&quot;</span>,</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>          <span class="dv">5</span>:<span class="st">&quot;dec&quot;</span>,</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>          <span class="dv">6</span>:<span class="st">&quot;jan&quot;</span>,</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>          <span class="dv">7</span>:<span class="st">&quot;feb&quot;</span>,</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>          <span class="dv">8</span>:<span class="st">&quot;mar&quot;</span>,</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>          <span class="dv">9</span>:<span class="st">&quot;apr&quot;</span>,</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>          <span class="dv">10</span>:<span class="st">&quot;may&quot;</span>,</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>          <span class="dv">11</span>:<span class="st">&quot;jun&quot;</span>,</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>          <span class="dv">12</span>:<span class="st">&quot;jul&quot;</span>}</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">dict</span>[i]</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> report(res):</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">## the argument ``res`` should be an instance of the class ``scipy.optimize.OptimizeResult`` -- </span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">## i.e. a value of the form returned by ``linprog``</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">##</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>res.x</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>    profit  <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>result.fun</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join([<span class="ss">f&quot;linprog succeeded? </span><span class="sc">{</span>result<span class="sc">.</span>success<span class="sc">}</span><span class="ss">&quot;</span>]</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>                     [<span class="ss">f&quot;Optimal profit $</span><span class="sc">{</span>profit<span class="sc">:,.2f}</span><span class="ss">&quot;</span>]</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span> </span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">&quot;This is achieved by the following strategy:</span><span class="ch">\n</span><span class="st">&quot;</span>]</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>                     [<span class="ss">f&quot;purchase in kg for </span><span class="sc">{</span>month(i<span class="op">+</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[i]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span> </span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">&quot;&quot;</span>]</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span> </span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>                     [<span class="ss">f&quot;storage in kg for </span><span class="sc">{</span>month(i<span class="op">+</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[i<span class="op">+</span><span class="dv">12</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span> </span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">&quot;&quot;</span>]                     </span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>                     <span class="op">+</span> </span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>                     [<span class="ss">f&quot;sales in kg for </span><span class="sc">{</span>month(i<span class="op">+</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>x[i<span class="op">+</span><span class="dv">24</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)])</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(report(result))</span></code></pre></div>
</div>
        </main>

        <footer>
	  <nav>
	    <a href="http://www.tufts.edu">
	      <i class="fas fa-chalkboard"></i>
	      Tufts
	    </a>	    
	    <a href="http://math.tufts.edu">
	      <i class="fas fa-chalkboard-teacher"></i>
	      Tufts Math
	    </a>
	    <a href="https://gmcninch-tufts.github.io/math">
	      <i class="fas fa-coffee"></i>
	      G McNinch
	    </a>
	    <a href="https://github.com/gmcninch-tufts">
	      <i class="fab fa-github"></i>
	      GitHub
	    </a>	    
	  </nav>
        </footer>
    </body>
</html>
